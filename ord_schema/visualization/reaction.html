<!DOCTYPE html>
<!--
 Copyright 2021 Open Reaction Database Project Authors

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.
-->

<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>{{ reaction.reaction_id }}</title>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <style>
      body {
          font-family: Roboto, sans-serif;
      }

      #nav {
          margin-right: 26px;
          position: fixed;
          width: 150px;
      }

      .navSection {
          padding: 8px;
          margin-bottom: 4px;
          cursor: pointer;
      }

      .navSection:hover {
          background-color: lightblue;
      }

      #sections {
          margin-left: 168px;
      }

      table {
          border-collapse: collapse;
      }

      th, td {
          padding: 5px 10px 5px 10px;
      }

      #inputs th, #inputs td {
          padding: 0 10px 0 10px;
      }

      tr.input_start {
          border-top: 1px solid black;
      }

      tr.input_end td {
          border-bottom: 1px solid black;
      }

      td.input_name {
          border-top: 1px solid black;
          border-bottom: 1px solid black;
      }

      .raw {
          display: none;
      }

      .float {
          display: inline-block;
      }
  </style>
</head>
<body>
<div id="nav">
  <div class="navSection" data-section="summary">Summary</div>
  <div class="navSection" data-section="identifiers">Identifiers</div>
  <div class="navSection" data-section="inputs">Inputs</div>
  <div class="navSection" data-section="setup">Setup</div>
  <div class="navSection" data-section="conditions">Conditions</div>
  <div class="navSection" data-section="notes">Notes</div>
  <div class="navSection" data-section="observations">Observations</div>
  <div class="navSection" data-section="workups">Workups</div>
  <div class="navSection" data-section="outcomes">Outcomes</div>
  <div class="navSection" data-section="provenance">Provenance</div>
  <div class="navSection" data-section="record">Full Record</div>
</div>
<div id="sections">
  <div id="identifiers">
    <h2>Identifiers</h2>
    <table>
      <tr>
        <td>Reaction ID</td>
        <td>{{ reaction.reaction_id }}</td>
        <td></td>
      </tr>
      {% for identifier in reaction.identifiers %}
        <tr>
          <td>{{ identifier.IdentifierType.Name(identifier.type) }}</td>
          <td>{{ identifier.value }}</td>
          <td>{{ identifier.details }}</td>
        </tr>
      {% endfor %}
    </table>
  </div>
  <div id="inputs">
    <h2>Inputs</h2>
{# Divide this up by input so we can put in the other input-specific fields. #}
    <table>
      <thead>
      <tr>
        <th>Input</th>
        <th>Compound</th>
        <th>Amount</th>
        <th>Role</th>
        <th>Raw</th>
      </tr>
      </thead>
      <tbody>
      {% for key, value in reaction.inputs|sort_addition_order %}
        {% for compound in value.components %}
          {% if loop.index0 == 0 %}
            <tr class="input_start">
              <td class="input_name" rowspan="{{ value.components|length }}">{{ key }}</td>
              {% elif loop.index == value.components|length %}
            <tr class="input_end">
              {% else %}
            <tr>
          {% endif %}
        <td style="text-align: center;">{{ compound|compound_svg(18) }}</td>
        <td>{{ compound|compound_amount }}</td>
        <td>{{ compound|compound_role }}</td>
        <td>
          <div><button class="toggle_raw">Show</button></div>
          <pre class="raw">{{ compound|pbtxt }}</pre>
        </td>
        </tr>
        {% endfor %}
      {% endfor %}
      </tbody>
    </table>
  </div>
  <div id="setup">
    <h2>Setup</h2>
    <div class="float">
    <h3>Vessel</h3>
    <table class="sub">
      <tr>
        <td>Type</td>
        <td>{{ reaction.setup.vessel|type_and_details }}</td>
      </tr>
      <tr>
        <td>Material</td>
        <td>{{ reaction.setup.vessel.material|type_and_details }}</td>
      </tr>
      <tr>
        <td>Volume</td>
        <td>{{ reaction.setup.vessel|vessel_size }}</td>
      </tr>
      {% if reaction.setup.vessel.attachments %}
      <tr>
        <td>Attachments</td>
        <td>
        <table>
          {% for attachment in reaction.setup.vessel.attachments %}
            <tr>
              <td>{{ attachment|type_and_details }}</td>
            </tr>
          {% endfor %}
        </table>
        </td>
      </tr>
      {% endif %}
      {% if reaction.setup.vessel.preparations %}
      <tr>
        <td>Preparations</td>
        <td>
        <table>
          {% for preparation in reaction.setup.vessel.preparations %}
            <tr>
              <td>{{ preparation|type_and_details }}</td>
            </tr>
          {% endfor %}
        </table>
        </td>
      </tr>
      {% endif %}
    </table>
    </div>
    {% if reaction.setup.is_automated %}
    <div class="float">
    <h3>Automation</h3>
    <table class="sub">
      <tr>
        <td>Platform</td>
        <td>{{ reaction.setup.automation_platform or 'UNSPECIFIED' }}</td>
      </tr>
    </table>
    </div>
    {% endif %}
    <div class="float">
    <h3>Environment</h3>
    <table class="sub">
      <tr>
        <td>Type</td>
        <td>{{ reaction.setup.environment|type_and_details }}</td>
      </tr>
    </table>
    </div>
  </div>
  <div id="conditions">
    <h2>Conditions</h2>
    {% if reaction.conditions.temperature|defined %}
    <div class="float">
    <h3>Temperature</h3>
    <table class="sub">
    <tr>
      <td>Control Type</td>
      <td>{{ reaction.conditions.temperature.control|type_and_details }}</td>
    </tr>
    <tr>
      <td>Setpoint</td>
      <td>{{ reaction.conditions.temperature.setpoint|unit_format }}</td>
    </tr>
    {% if reaction.conditions.temperature.measurements %}
    <tr>
      <td>Measurements</td>
      <td colspan="2">
        <table>
          <thead>
          <tr>
            <th>Type</th>
            <th>Time</th>
            <th>Temperature</th>
          </tr>
          </thead>
          <tbody>
          {% for measurement in reaction.conditions.temperature.measurements %}
          <tr>
            <td>{{ measurement|type_and_details }}</td>
            <td>{{ measurement.time|unit_format }}</td>
            <td>{{ measurement.temperature|unit_format }}</td>
          </tr>
          {% endfor %}
          </tbody>
        </table>
      </td>
    </tr>
    {% endif %}
    </table>
    </div>
    {% endif %}
    {% if reaction.conditions.pressure|defined %}
    <div class="float">
    <h3>Pressure</h3>
    <table class="sub">
    <tr>
      <td>Control Type</td>
      <td>{{ reaction.conditions.pressure.control|type_and_details }}</td>
    </tr>
    <tr>
      <td>Setpoint</td>
      <td>{{ reaction.conditions.pressure.setpoint|unit_format }}</td>
    </tr>
    <tr>
      <td>Atmosphere</td>
      <td>{{ reaction.conditions.pressure.atmosphere|type_and_details }}</td>
    </tr>
    {% if reaction.conditions.pressure.measurements %}
    <tr>
      <td>Measurements</td>
      <td colspan="2">
        <table>
          <thead>
          <tr>
            <th>Type</th>
            <th>Time</th>
            <th>Pressure</th>
          </tr>
          </thead>
          <tbody>
          {% for measurement in reaction.conditions.pressure.measurements %}
          <tr>
            <td>{{ measurement|type_and_details }}</td>
            <td>{{ measurement.time|unit_format }}</td>
            <td>{{ measurement.pressure|unit_format }}</td>
          </tr>
          {% endfor %}
          </tbody>
        </table>
      </td>
    </tr>
    {% endif %}
    </table>
    </div>
    {% endif %}
    {% if reaction.conditions.stirring|defined %}
    <div class="float">
    <h3>Stirring</h3>
    <table class="sub">
    <tr>
      <td>Type</td>
      <td>{{ reaction.conditions.stirring|type_and_details }}</td>
    </tr>
    <tr>
      <td>Rate</td>
      <td>{{ reaction.conditions.stirring.rate|type_and_details }}</td>
    </tr>
    {% if reaction.conditions.stirring.rate.rpm %}
    <tr>
      <td>RPM</td>
      <td>{{ reaction.conditions.stirring.rate.rpm }}</td>
    </tr>
    {% endif %}
    </table>
    </div>
    {% endif %}
    {% if reaction.conditions.illumination|defined %}
    <div class="float">
    <h3>Illumination</h3>
    <table class="sub">
    <tr>
      <td>Type</td>
      <td>{{ reaction.conditions.illumination|type_and_details }}</td>
    </tr>
    <tr>
      <td>Peak Wavelength</td>
      <td>{{ reaction.conditions.illumination.peak_wavelength|unit_format }}</td>
    </tr>
    {% if reaction.conditions.illumination.color %}
    <tr>
      <td>Color</td>
      <td>{{ reaction.conditions.illumination.color }}</td>
    </tr>
    {% endif %}
    <tr>
      <td>Distance to Vessel</td>
      <td>{{ reaction.conditions.illumination.distance_to_vessel|unit_format }}</td>
    </tr>
    </table>
    </div>
    {% endif %}
    {% if reaction.conditions.electrochemistry|defined %}
    <div class="float">
    <h3>Electrochemistry</h3>
    <table class="sub">
    <tr>
      <td>Type</td>
      <td>{{ reaction.conditions.electrochemistry|type_and_details }}</td>
    </tr>
    <tr>
      <td>Cell Type</td>
      <td>{{ reaction.conditions.electrochemistry.cell|type_and_details }}</td>
    </tr>
    <tr>
      <td>Current</td>
      <td>{{ reaction.conditions.electrochemistry.current|unit_format }}</td>
    </tr>
    <tr>
      <td>Voltage</td>
      <td>{{ reaction.conditions.electrochemistry.voltage|unit_format }}</td>
    </tr>
    {% if reaction.conditions.electrochemistry.anode_material %}
    <tr>
      <td>Anode Material</td>
      <td>{{ reaction.conditions.electrochemistry.anode_material }}</td>
    </tr>
    {% endif %}
    {% if reaction.conditions.electrochemistry.cathode_material %}
    <tr>
      <td>Cathode Material</td>
      <td>{{ reaction.conditions.electrochemistry.cathode_material }}</td>
    </tr>
    {% endif %}
    <tr>
      <td>Electrode Separation</td>
      <td>{{ reaction.conditions.electrochemistry.electrode_separation|unit_format }}</td>
    </tr>
    </tr>
    <tr>
      <td>Rate</td>
      <td>{{ reaction.conditions.stirring.rate|type_and_details }}</td>
    </tr>
    {% if reaction.conditions.stirring.rate.rpm %}
    <tr>
      <td>RPM</td>
      <td>{{ reaction.conditions.stirring.rate.rpm }}</td>
    </tr>
    {% endif %}
    {% if reaction.conditions.electrochemistry.measurements %}
    <tr>
      <td>Measurements</td>
      <td colspan="2">
        <table>
          <thead>
          <tr>
            <th>Time</th>
            <th>Value</th>
          </tr>
          </thead>
          <tbody>
          {% for measurement in reaction.conditions.electrochemistry.measurements %}
          <tr>
            <td>{{ measurement.time|unit_format }}</td>
            <td>{{ measurement|oneof|unit_format }}</td>
          </tr>
          {% endfor %}
          </tbody>
        </table>
      </td>
    </tr>
    {% endif %}
    </table>
    </div>
    {% endif %}
    {% if reaction.conditions.flow|defined %}
    <div class="float">
    <h3>Flow</h3>
    <table class="sub">
    <tr>
      <td>Type</td>
      <td>{{ reaction.conditions.flow|type_and_details }}</td>
    </tr>
    {% if reaction.conditions.flow.pump_type %}
    <tr>
      <td>Pump Type</td>
      <td>{{ reaction.conditions.flow.pump_type }}</td>
    </tr>
    {% endif %}
    <tr>
      <td>Tubing</td>
      <td>{{ reaction.conditions.flow.tubing|type_and_details }}</td>
    </tr>
    <tr>
      <td>Tubing Diameter</td>
      <td>{{ reaction.conditions.flow.tubing.diameter|unit_format }}</td>
    </tr>
    </table>
    </div>
    {% endif %}
  </div>
  <div id="notes">
    <h2>Notes</h2>
    <table>
      {% if reaction.notes.HasField('is_heterogeneous') %}
      <tr>
        <td>Heterogeneous</td>
        <td>{{ reaction.notes.is_heterogeneous }}</td>
      </tr>
      {% endif %}
      {% if reaction.notes.HasField('forms_precipitate') %}
      <tr>
        <td>Forms precipitate</td>
        <td>{{ reaction.notes.forms_precipitate }}</td>
      </tr>
      {% endif %}
      {% if reaction.notes.HasField('is_exothermic') %}
      <tr>
        <td>Exothermic</td>
        <td>{{ reaction.notes.is_exothermic }}</td>
      </tr>
      {% endif %}
      {% if reaction.notes.HasField('offgasses') %}
      <tr>
        <td>Offgasses</td>
        <td>{{ reaction.notes.offgasses }}</td>
      </tr>
      {% endif %}
      {% if reaction.notes.HasField('is_sensitive_to_moisture') %}
      <tr>
        <td>Sensitive to moisture</td>
        <td>{{ reaction.notes.is_sensitive_to_moisture }}</td>
      </tr>
      {% endif %}
      {% if reaction.notes.HasField('is_sensitive_to_oxygen') %}
      <tr>
        <td>Sensitive to oxygen</td>
        <td>{{ reaction.notes.is_sensitive_to_oxygen }}</td>
      </tr>
      {% endif %}
      {% if reaction.notes.HasField('is_sensitive_to_light') %}
      <tr>
        <td>Sensitive to light</td>
        <td>{{ reaction.notes.is_sensitive_to_light }}</td>
      </tr>
      {% endif %}
      {% if reaction.notes.safety_notes %}
      <tr>
        <td>Safety notes</td>
        <td>reaction.notes.safety_notes</td>
      </tr>
      {% endif %}
      {% if reaction.notes.procedure_details %}
      <tr>
        <td>Procedure details</td>
        <td>reaction.notes.procedure_details</td>
      </tr>
      {% endif %}
    </table>
  </div>
  <div id="observations">
    <h2>Observations</h2>
    {% if reaction.observations %}
    <table>
      <thead>
      <tr>
        <th>Time</th>
        <th>Comment</th>
      </tr>
      </thead>
      {% for observation in reaction.observations %}
      <tr>
        <td>{{ observation.time|unit_format }}</td>
        <td>{{ observation.comment }}</td>
      </tr>
      {% endfor %}
    </table>
    {% endif %}
  </div>
  <div id="workups">
    <h2>Workups</h2>
  </div>
  <div id="outcomes">
    <h2>Outcomes</h2>
  </div>
  <div id="provenance">
    <h2>Provenance</h2>
  </div>
  <div id="record">
    <h2>Full Record</h2>
    <div id="pbtxt" style="font-family: monospace; white-space: pre-wrap;">{{ reaction|pbtxt }}</div>
  </div>
</div>
<script>
    document.body.onload = function () {
        $('.navSection').click(event => {
            const section = $(event.target).attr('data-section');
            $('#' + section)[0].scrollIntoView({behavior: 'smooth'});
        });
        if (location.hash) {
            const section = location.hash.replace('#', '');
            $('#' + section)[0].scrollIntoView({behavior: 'smooth'});
        }
        $('.toggle_raw').on('click', function () {
            const element = $(this);
            const target = element.parent().siblings('.raw');
            if (element.text() === 'Show') {
                target.show();
                element.text('Hide');
            } else {
                target.hide();
                element.text('Show');
            }
        });
    };
</script>
</body>
</html>
